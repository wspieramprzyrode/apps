Parameters:
  <<: !Include '../../_parameters.yml'

  appName:
    Type: String
    Default: 'guardduty'

  accountId:
    Type: String
    Description: The identifier from the account used to manage GuardDuty
    Default: !Ref SecurityAccount

GuardDuty:
  Type: update-stacks
  Template: ./guard-duty.yml
  StackName: !Sub '${resourcePrefix}-${appName}'
  StackDescription: GuardDuty - Base
  TerminationProtection: true
  DefaultOrganizationBindingRegion: !Ref primaryRegion
  DefaultOrganizationBinding:
    Account: !Ref accountId
  OrganizationBindings:
    LogArchiveBinding:
      Account: !Ref LogArchiveAccount
    MemberBinding:
      Account: '*'
      IncludeMasterAccount: true
      ExcludeAccount:
        - !Ref accountId
    AllBinding:
      Account: '*'
      IncludeMasterAccount: true
  Parameters:
    resourcePrefix: !Ref resourcePrefix
    accountId: !Ref accountId
    bucketName: !Sub '${resourcePrefix}-${appName}-finding-${CurrentAccount.AccountId}'